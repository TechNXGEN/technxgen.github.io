<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-bs-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio | NXGEN - Tech Blog</title><meta name=description content="Create a Python script to split audiobooks into manageable chunks and convert them to MP3 format for better compatibility with car audio systems"><meta property="og:url" content="https://nxgen.tech/blog/2024/11/10/building-an-audiobook-processor-splitting-and-converting-m4b-files-for-car-audio/"><meta property="og:site_name" content="NXGEN - Tech Blog"><meta property="og:title" content="Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio"><meta property="og:description" content="Create a Python script to split audiobooks into manageable chunks and convert them to MP3 format for better compatibility with car audio systems"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-11-10T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-17T13:04:33-05:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Ffmpeg"><meta property="article:tag" content="Audio Processing"><meta property="article:tag" content="Automation"><meta property="article:tag" content="Scripting"><meta itemprop=name content="Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio"><meta itemprop=description content="Create a Python script to split audiobooks into manageable chunks and convert them to MP3 format for better compatibility with car audio systems"><meta itemprop=datePublished content="2024-11-10T00:00:00+00:00"><meta itemprop=dateModified content="2024-11-17T13:04:33-05:00"><meta itemprop=wordCount content="1499"><meta itemprop=keywords content="Python,Ffmpeg,Audio Processing,Automation,Scripting"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio"><meta name=twitter:description content="Create a Python script to split audiobooks into manageable chunks and convert them to MP3 format for better compatibility with car audio systems"><link rel=preload href=/scss/main.min.7da6d9aed92d1d7381408a02392860039119bd41e551bb32962f8c67cc9c7d6c.css as=style integrity="sha256-fabZrtktHXOBQIoCOShgA5EZvUHlUbsyli+MZ8ycfWw=" crossorigin=anonymous><link href=/scss/main.min.7da6d9aed92d1d7381408a02392860039119bd41e551bb32962f8c67cc9c7d6c.css rel=stylesheet integrity="sha256-fabZrtktHXOBQIoCOShgA5EZvUHlUbsyli+MZ8ycfWw=" crossorigin=anonymous><script src=/js/jquery-3.7.1.min.js></script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 800 800"><defs><clipPath clipPathUnits="userSpaceOnUse" id="a"><path d="M0 6e2h6e2V0H0z"/></clipPath></defs><g clip-path="url(#a)" transform="matrix(1.33333 0 0 -1.33333 0 800)"><path d="M377.03 337.54c-5.2.58-10.21.08-14.86-1.28L169.3 480.79H119.2V119.21h236.13l-60.32 45.2H164.4v256.24a3.66 3.66.0 005.85 2.93L335.1 300.07a37.67 37.67.0 1175.15 3.8 37.8 37.8.0 01-33.22 33.67" fill="#fafafa"/><path d="M222.98 262.46c5.2-.58 10.2-.08 14.85 1.28L430.7 119.21h50.08v361.58H244.66l60.32-45.2h130.61V178.8a3.38 3.38.0 00-5.4-2.7L264.9 299.92a37.67 37.67.0 11-75.14-3.83 37.79 37.79.0 0133.22-33.64" fill="#58d02a"/></g></svg></span><span class=navbar-brand__name>NXGEN - Tech Blog</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><ul class="list-inline d-inline mb-0"><li class="list-inline-item mx-2 mt-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://x.com/technxgen aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul><ul class="list-inline d-inline mb-0"><li class="list-inline-item mx-2 mt-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/TechNXGEN aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ title="NXGEN Tech Blog" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>NXGEN</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="NXGEN Blog" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-blog><span>Blog</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20241119mastering-cpu-configuration-in-qemu-a-deep-dive-into-virtual-development-environments-li><a href=/blog/2024/11/19/mastering-cpu-configuration-in-qemu-a-deep-dive-into-virtual-development-environments/ title="Mastering CPU Configuration in QEMU: A Deep Dive into Virtual Development Environments" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20241119mastering-cpu-configuration-in-qemu-a-deep-dive-into-virtual-development-environments><span>QEMU CPU Configuration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20241116unreal-engine-55-next-gen-rendering-and-performance-li><a href=/blog/2024/11/16/unreal-engine-5.5-next-gen-rendering-and-performance/ title="Unreal Engine 5.5: Next-Gen Rendering and Performance" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20241116unreal-engine-55-next-gen-rendering-and-performance><span>UE5.5 Release Notes Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20241110building-an-audiobook-processor-splitting-and-converting-m4b-files-for-car-audio-li><a href=/blog/2024/11/10/building-an-audiobook-processor-splitting-and-converting-m4b-files-for-car-audio/ title="Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20241110building-an-audiobook-processor-splitting-and-converting-m4b-files-for-car-audio><span class=td-sidebar-nav-active-item>Audiobook Processor</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20241109welcome-to-my-ui-programming-journey-in-unreal-engine-li><a href=/blog/2024/11/09/welcome-to-my-ui-programming-journey-in-unreal-engine/ title="Welcome to My UI Programming Journey in Unreal Engine" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20241109welcome-to-my-ui-programming-journey-in-unreal-engine><span>Welcome</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-4 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#the-challenge-car-audio-and-audiobooks>The Challenge: Car Audio and Audiobooks</a></li><li><a href=#technical-requirements>Technical Requirements</a></li><li><a href=#the-solution-ffmpeg-powered-python-script>The Solution: FFmpeg-Powered Python Script</a><ul><li><a href=#1-duration-detection>1. Duration Detection</a></li><li><a href=#2-core-processing-logic>2. Core Processing Logic</a></li><li><a href=#3-speed-adjustment-implementation>3. Speed Adjustment Implementation</a></li></ul></li><li><a href=#using-the-script>Using the Script</a><ul><li><a href=#command-line-arguments>Command Line Arguments</a></li></ul></li><li><a href=#technical-considerations>Technical Considerations</a><ul><li><a href=#performance-optimization>Performance Optimization</a></li><li><a href=#error-handling>Error Handling</a></li></ul></li><li><a href=#future-improvements>Future Improvements</a></li><li><a href=#technical-requirements-1>Technical Requirements</a></li><li><a href=#installation-guide>Installation Guide</a><ul><li><a href=#installing-python>Installing Python</a></li><li><a href=#installing-ffmpeg>Installing FFmpeg</a></li><li><a href=#verifying-installation>Verifying Installation</a></li></ul></li><li><a href=#setting-up-the-script>Setting Up the Script</a><ul><li><a href=#download-options>Download Options</a></li><li><a href=#first-time-setup>First-Time Setup</a></li></ul></li><li><a href=#step-by-step-usage-guide>Step-by-Step Usage Guide</a><ul><li><a href=#common-issues-and-solutions>Common Issues and Solutions</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://nxgen.tech/tags/audio-processing/ data-taxonomy-term=audio-processing><span class=taxonomy-label>Audio Processing</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/c++/ data-taxonomy-term=c++><span class=taxonomy-label>C++</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/cpu-configuration/ data-taxonomy-term=cpu-configuration><span class=taxonomy-label>CPU Configuration</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/development-environment/ data-taxonomy-term=development-environment><span class=taxonomy-label>Development Environment</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/ffmpeg/ data-taxonomy-term=ffmpeg><span class=taxonomy-label>Ffmpeg</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/game-development/ data-taxonomy-term=game-development><span class=taxonomy-label>Game Development</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/gaming-hardware/ data-taxonomy-term=gaming-hardware><span class=taxonomy-label>Gaming Hardware</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/graphics-programming/ data-taxonomy-term=graphics-programming><span class=taxonomy-label>Graphics Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/hypervisor/ data-taxonomy-term=hypervisor><span class=taxonomy-label>Hypervisor</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/performance/ data-taxonomy-term=performance><span class=taxonomy-label>Performance</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/performance-optimization/ data-taxonomy-term=performance-optimization><span class=taxonomy-label>Performance Optimization</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/python/ data-taxonomy-term=python><span class=taxonomy-label>Python</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/qemu/ data-taxonomy-term=qemu><span class=taxonomy-label>QEMU</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/ray-tracing/ data-taxonomy-term=ray-tracing><span class=taxonomy-label>Ray Tracing</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/rendering/ data-taxonomy-term=rendering><span class=taxonomy-label>Rendering</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/scripting/ data-taxonomy-term=scripting><span class=taxonomy-label>Scripting</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/ui-programming/ data-taxonomy-term=ui-programming><span class=taxonomy-label>Ui Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/umg/ data-taxonomy-term=umg><span class=taxonomy-label>Umg</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/unreal-engine/ data-taxonomy-term=unreal-engine><span class=taxonomy-label>Unreal Engine</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/virtualization/ data-taxonomy-term=virtualization><span class=taxonomy-label>Virtualization</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://nxgen.tech/categories/audio-tools/ data-taxonomy-term=audio-tools><span class=taxonomy-label>Audio Tools</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/development/ data-taxonomy-term=development><span class=taxonomy-label>Development</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/development-tools/ data-taxonomy-term=development-tools><span class=taxonomy-label>Development Tools</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/game-development/ data-taxonomy-term=game-development><span class=taxonomy-label>Game Development</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/graphics-programming/ data-taxonomy-term=graphics-programming><span class=taxonomy-label>Graphics Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/performance-optimization/ data-taxonomy-term=performance-optimization><span class=taxonomy-label>Performance Optimization</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/ui-engineering/ data-taxonomy-term=ui-engineering><span class=taxonomy-label>UI Engineering</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/virtualization/ data-taxonomy-term=virtualization><span class=taxonomy-label>Virtualization</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-5" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Building an Audiobook Processor: Splitting and Converting M4B Files for Car Audio</h1><div class=lead>Create a Python script to split audiobooks into manageable chunks and convert them to MP3 format for better compatibility with car audio systems</div><div class="td-byline mb-4">By <b>NXGEN</b> |
<time datetime=2024-11-10 class=text-body-secondary>Sunday, November 10, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://nxgen.tech/tags/python/ data-taxonomy-term=python><span class=taxonomy-label>Python</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/ffmpeg/ data-taxonomy-term=ffmpeg><span class=taxonomy-label>Ffmpeg</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/audio-processing/ data-taxonomy-term=audio-processing><span class=taxonomy-label>Audio Processing</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/tags/scripting/ data-taxonomy-term=scripting><span class=taxonomy-label>Scripting</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://nxgen.tech/categories/development/ data-taxonomy-term=development><span class=taxonomy-label>Development</span></a></li><li><a class=taxonomy-term href=https://nxgen.tech/categories/audio-tools/ data-taxonomy-term=audio-tools><span class=taxonomy-label>Audio Tools</span></a></li></ul></div></header><div class="pageinfo pageinfo-primary"><p>Learn how to build a Python script that processes M4B audiobook files into smaller, more manageable MP3 chunks while preserving audio quality and providing flexible customization options.</p></div><h2 id=the-challenge-car-audio-and-audiobooks>The Challenge: Car Audio and Audiobooks<a class=td-heading-self-link href=#the-challenge-car-audio-and-audiobooks aria-label="Heading self-link"></a></h2><p>Modern audiobooks often come in M4B format, which while great for dedicated audiobook players, can present challenges when used with simpler audio systems like car stereos. I recently faced this exact problem: I had a lengthy audiobook I wanted to listen to during my commute, but my car&rsquo;s audio system had two major limitations:</p><ol><li>No support for M4B format files</li><li>No ability to fast-forward or rewind within tracks - only track skipping was supported</li></ol><p>The solution? Create a script that could split the audiobook into smaller, more manageable chunks while converting them to a widely-supported format.</p><h2 id=technical-requirements>Technical Requirements<a class=td-heading-self-link href=#technical-requirements aria-label="Heading self-link"></a></h2><p>Before diving into the implementation, let&rsquo;s outline our key requirements:</p><ol><li><strong>Format Conversion</strong>: Convert M4B to MP3 format</li><li><strong>Chunking</strong>: Split the audiobook into fixed-duration segments</li><li><strong>Quality Preservation</strong>: Maintain audio quality during conversion</li><li><strong>Flexibility</strong>: Allow customization of chunk size, audio quality, and playback speed</li><li><strong>Robustness</strong>: Handle errors gracefully and provide clear feedback</li></ol><h2 id=the-solution-ffmpeg-powered-python-script>The Solution: FFmpeg-Powered Python Script<a class=td-heading-self-link href=#the-solution-ffmpeg-powered-python-script aria-label="Heading self-link"></a></h2><p>The solution leverages FFmpeg, a powerful multimedia framework, wrapped in a Python script for ease of use and flexibility. Here&rsquo;s how we implemented each component:</p><h3 id=1-duration-detection>1. Duration Detection<a class=td-heading-self-link href=#1-duration-detection aria-label="Heading self-link"></a></h3><p>First, we need to determine the total duration of the audiobook:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_duration</span><span class=p>(</span><span class=n>input_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Get the duration of the audio file in seconds using ffprobe&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ffprobe&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-v&#39;</span><span class=p>,</span> <span class=s1>&#39;quiet&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-show_entries&#39;</span><span class=p>,</span> <span class=s1>&#39;format=duration&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-of&#39;</span><span class=p>,</span> <span class=s1>&#39;default=noprint_wrappers=1:nokey=1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input_file</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>rstrip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span></code></pre></div><p>This function uses <code>ffprobe</code> to extract the duration metadata from the input file, providing the foundation for our chunking calculations.</p><h3 id=2-core-processing-logic>2. Core Processing Logic<a class=td-heading-self-link href=#2-core-processing-logic aria-label="Heading self-link"></a></h3><p>The main processing function handles the chunking and conversion process:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_audiobook</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>input_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>output_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk_duration</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>speed_factor</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>start_chunk</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_chunks</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>audio_quality</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=s2>&#34;192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>sample_rate</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=s2>&#34;44100&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span></code></pre></div><p>Key features include:</p><ul><li>Customizable chunk duration (default: 10 minutes)</li><li>Playback speed adjustment</li><li>Selective chunk processing</li><li>Configurable audio quality and sample rate</li></ul><h3 id=3-speed-adjustment-implementation>3. Speed Adjustment Implementation<a class=td-heading-self-link href=#3-speed-adjustment-implementation aria-label="Heading self-link"></a></h3><p>One interesting challenge was implementing variable playback speed. FFmpeg&rsquo;s <code>atempo</code> filter has a limitation: it only works within the range of 0.5x to 2.0x. To overcome this, we chain multiple <code>atempo</code> filters:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>speed_factor</span> <span class=o>&gt;</span> <span class=mf>2.0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_chain</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s1>&#39;atempo=2.0&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=n>speed_factor</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                           <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=n>speed_factor</span> <span class=o>%</span> <span class=mi>2</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>speed_factor</span> <span class=o>&lt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_chain</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s1>&#39;atempo=0.5&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=mi>2</span> <span class=o>/</span> <span class=n>speed_factor</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                           <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=mi>1</span> <span class=o>/</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>speed_factor</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>tempo_chain</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=n>speed_factor</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span></code></pre></div><p>This allows us to achieve any playback speed while maintaining audio quality.</p><h2 id=using-the-script>Using the Script<a class=td-heading-self-link href=#using-the-script aria-label="Heading self-link"></a></h2><p>The script provides a simple command-line interface:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python audiobook_processor.py input.m4b output_directory <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --chunk-duration <span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --speed 1.05 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --quality <span class=m>192</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --sample-rate <span class=m>44100</span>
</span></span></code></pre></div><h3 id=command-line-arguments>Command Line Arguments<a class=td-heading-self-link href=#command-line-arguments aria-label="Heading self-link"></a></h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Available Options</h4><ul><li><code>input_file</code>: Path to the M4B file</li><li><code>output_dir</code>: Directory for the output MP3 files</li><li><code>--chunk-duration</code>: Length of each chunk in minutes (default: 10)</li><li><code>--speed</code>: Playback speed factor (default: 1.05)</li><li><code>--quality</code>: Output audio bitrate in kbps (default: 192)</li><li><code>--sample-rate</code>: Output sample rate in Hz (default: 44100)</li></ul></div><h2 id=technical-considerations>Technical Considerations<a class=td-heading-self-link href=#technical-considerations aria-label="Heading self-link"></a></h2><h3 id=performance-optimization>Performance Optimization<a class=td-heading-self-link href=#performance-optimization aria-label="Heading self-link"></a></h3><p>The script is designed to be memory-efficient by:</p><ol><li>Processing chunks sequentially</li><li>Using FFmpeg&rsquo;s built-in seeking capabilities</li><li>Avoiding loading the entire file into memory</li></ol><h3 id=error-handling>Error Handling<a class=td-heading-self-link href=#error-handling aria-label="Heading self-link"></a></h3><p>Robust error handling ensures the script:</p><ul><li>Validates input parameters</li><li>Catches and reports FFmpeg processing errors</li></ul><h2 id=future-improvements>Future Improvements<a class=td-heading-self-link href=#future-improvements aria-label="Heading self-link"></a></h2><p>Potential enhancements could include:</p><ol><li>Parallel processing for faster conversion</li><li>Chapter-aware splitting</li><li>Progress bar and ETA estimation</li><li>Audio normalization options</li></ol><h2 id=technical-requirements-1>Technical Requirements<a class=td-heading-self-link href=#technical-requirements-1 aria-label="Heading self-link"></a></h2><p>To use this script, you&rsquo;ll need:</p><ul><li>Python 3.6 or higher</li><li>FFmpeg installed and available in your system PATH</li><li>Sufficient disk space for the output files</li></ul><h2 id=installation-guide>Installation Guide<a class=td-heading-self-link href=#installation-guide aria-label="Heading self-link"></a></h2><p>Before using the script, you&rsquo;ll need to install Python and FFmpeg on your system. Here are multiple ways to get started:</p><h3 id=installing-python>Installing Python<a class=td-heading-self-link href=#installing-python aria-label="Heading self-link"></a></h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Python Version</h4>The script requires Python 3.6 or higher. The latest stable version is recommended.</div><p><strong>Option 1: Direct Download</strong></p><ul><li>Visit <a href=https://www.python.org/downloads/>python.org</a></li><li>Download and run the installer for your operating system</li><li>Make sure to check &ldquo;Add Python to PATH&rdquo; during installation</li></ul><p><strong>Option 2: Windows Package Managers</strong></p><p>Using winget:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>winget install Python.Python.3.11
</span></span></code></pre></div><p>Using Chocolatey:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>choco install python
</span></span></code></pre></div><h3 id=installing-ffmpeg>Installing FFmpeg<a class=td-heading-self-link href=#installing-ffmpeg aria-label="Heading self-link"></a></h3><p><strong>Option 1: Direct Download</strong></p><ul><li>Visit <a href=https://ffmpeg.org/download.html>ffmpeg.org</a></li><li>Download the appropriate version for your system</li><li>Extract the archive and add the bin folder to your system&rsquo;s PATH</li></ul><p><strong>Option 2: Windows Package Managers</strong></p><p>Using winget:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>winget install <span class=s2>&#34;FFmpeg (Essentials Build)&#34;</span>
</span></span></code></pre></div><p>Using Chocolatey:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>choco install ffmpeg
</span></span></code></pre></div><h3 id=verifying-installation>Verifying Installation<a class=td-heading-self-link href=#verifying-installation aria-label="Heading self-link"></a></h3><p>Open a new terminal/command prompt and verify both installations:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python --version
</span></span><span class=line><span class=cl>ffmpeg -version
</span></span></code></pre></div><h2 id=setting-up-the-script>Setting Up the Script<a class=td-heading-self-link href=#setting-up-the-script aria-label="Heading self-link"></a></h2><h3 id=download-options>Download Options<a class=td-heading-self-link href=#download-options aria-label="Heading self-link"></a></h3><ol><li><strong>Direct Download</strong>: <em><a href=/files/audiobook-processor.py download>audiobook-processor.py</a></em></li><li><strong>Copy from Below</strong>: Copy the complete script from this code block:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>argparse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numbers</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_duration</span><span class=p>(</span><span class=n>input_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Get the duration of the audio file in seconds using ffprobe&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ffprobe&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-v&#39;</span><span class=p>,</span> <span class=s1>&#39;quiet&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-show_entries&#39;</span><span class=p>,</span> <span class=s1>&#39;format=duration&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;-of&#39;</span><span class=p>,</span> <span class=s1>&#39;default=noprint_wrappers=1:nokey=1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>input_file</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Total duration: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span><span class=si>}</span><span class=s2> seconds&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>rstrip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=o>.</span><span class=n>stderr</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>stderr</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_audiobook</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>input_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>output_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk_duration</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>speed_factor</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>start_chunk</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_chunks</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>audio_quality</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=s2>&#34;192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>sample_rate</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=s2>&#34;44100&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Process an M4B audiobook file (or any other media supported by FFMpeg)
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        input_file: Path to input M4B file
</span></span></span><span class=line><span class=cl><span class=s2>        output_dir: Directory to save output files
</span></span></span><span class=line><span class=cl><span class=s2>        chunk_duration: Duration of each chunk in minutes
</span></span></span><span class=line><span class=cl><span class=s2>        speed_factor: Speed adjustment factor (1.0 = normal speed)
</span></span></span><span class=line><span class=cl><span class=s2>        start_chunk: First chunk to process (1-based indexing)
</span></span></span><span class=line><span class=cl><span class=s2>        max_chunks: Maximum number of chunks to process (None = process all)
</span></span></span><span class=line><span class=cl><span class=s2>        audio_quality: Output audio bitrate
</span></span></span><span class=line><span class=cl><span class=s2>        sample_rate: Output audio sample rate
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create output directory if it doesn&#39;t exist</span>
</span></span><span class=line><span class=cl>    <span class=n>Path</span><span class=p>(</span><span class=n>output_dir</span><span class=p>)</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get total duration</span>
</span></span><span class=line><span class=cl>    <span class=n>total_duration</span> <span class=o>=</span> <span class=n>get_duration</span><span class=p>(</span><span class=n>input_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>total_duration</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Cannot determine total audiobook duration, make sure the file is valid.</span><span class=se>\n\r</span><span class=s2>File: </span><span class=si>{</span><span class=n>input_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>chunk_seconds</span> <span class=o>=</span> <span class=n>chunk_duration</span> <span class=o>*</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>    <span class=n>total_chunks</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=n>total_duration</span> <span class=o>/</span> <span class=n>chunk_seconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>max_chunks</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>total_chunks</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>total_chunks</span><span class=p>,</span> <span class=n>start_chunk</span> <span class=o>+</span> <span class=n>max_chunks</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Total duration: </span><span class=si>{</span><span class=n>total_duration</span> <span class=o>/</span> <span class=mi>60</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2> minutes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing chunks </span><span class=si>{</span><span class=n>start_chunk</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>total_chunks</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Process each chunk</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>start_chunk</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>total_chunks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>i</span> <span class=o>*</span> <span class=n>chunk_seconds</span>
</span></span><span class=line><span class=cl>        <span class=n>duration</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>chunk_seconds</span><span class=p>,</span> <span class=n>total_duration</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>output_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>output_dir</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>Path</span><span class=p>(</span><span class=n>input_file</span><span class=p>)</span><span class=o>.</span><span class=n>stem</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>:</span><span class=s2>03</span><span class=si>}</span><span class=s2>.mp3&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Build FFMpeg command</span>
</span></span><span class=line><span class=cl>        <span class=n>cmd</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;ffmpeg&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-y&#39;</span><span class=p>,</span>  <span class=c1># Overwrite output file if exists</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-ss&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>start_time</span><span class=p>),</span>  <span class=c1># Start time</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-i&#39;</span><span class=p>,</span> <span class=n>input_file</span><span class=p>,</span>  <span class=c1># Input file</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-t&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>duration</span><span class=p>),</span>  <span class=c1># Duration to extract</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Add speed adjustment filter if needed</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>speed_factor</span> <span class=o>&lt;=</span> <span class=mf>0.0</span><span class=p>)</span> <span class=ow>or</span> <span class=p>((</span><span class=mi>1</span> <span class=o>/</span> <span class=n>speed_factor</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mf>0.0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Speed factor is too small, operation aborted.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>speed_factor</span> <span class=o>!=</span> <span class=mf>1.0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># atempo filter is limited to 0.5 to 2.0 range</span>
</span></span><span class=line><span class=cl>            <span class=c1># for larger changes, we need to chain multiple atempo filters</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>speed_factor</span> <span class=o>&gt;</span> <span class=mf>2.0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tempo_chain</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s1>&#39;atempo=2.0&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=n>speed_factor</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                                       <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=n>speed_factor</span> <span class=o>%</span> <span class=mi>2</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>speed_factor</span> <span class=o>&lt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tempo_chain</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s1>&#39;atempo=0.5&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=mi>2</span> <span class=o>/</span> <span class=n>speed_factor</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                                       <span class=p>[</span><span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=mi>1</span> <span class=o>/</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>speed_factor</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tempo_chain</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;atempo=</span><span class=si>{</span><span class=n>speed_factor</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cmd</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-filter:a&#39;</span><span class=p>,</span> <span class=n>tempo_chain</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Add output options</span>
</span></span><span class=line><span class=cl>        <span class=n>cmd</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-b:a&#39;</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>audio_quality</span><span class=si>}</span><span class=s1>k&#39;</span><span class=p>,</span>  <span class=c1># Audio bitrate</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-map_metadata&#39;</span><span class=p>,</span> <span class=s1>&#39;-1&#39;</span><span class=p>,</span>  <span class=c1># Remove metadata</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-map&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span>            <span class=c1># Remove video</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;-ar&#39;</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>sample_rate</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>         <span class=c1># Sample Rate</span>
</span></span><span class=line><span class=cl>            <span class=n>output_file</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Execute FFMpeg command</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing chunk </span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>total_chunks</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>output_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n\r</span><span class=s2>Command:</span><span class=se>\n\r</span><span class=si>{</span><span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=si>}</span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error processing chunk </span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&#34;Split and speed up M4B audiobooks using FFMpeg&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;input_file&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Input M4B file path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;output_dir&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Output directory path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--chunk-duration&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Duration of each chunk in minutes (default: 10)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--speed&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>1.00</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Playback speed factor (default: 1.05)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--start-chunk&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;First chunk to process (default: 1)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--max-chunks&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Maximum number of chunks to process (default: all)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--quality&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>&#34;192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Output audio bitrate (default: 192k)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--sample-rate&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>&#34;44100&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Output audio bitrate (default: 44100k)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>process_audiobook</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>input_file</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>output_dir</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>chunk_duration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>speed</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>start_chunk</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>max_chunks</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>quality</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>args</span><span class=o>.</span><span class=n>sample_rate</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=first-time-setup>First-Time Setup<a class=td-heading-self-link href=#first-time-setup aria-label="Heading self-link"></a></h3><p>Create a new directory for your audio processing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir audiobook-processor
</span></span><span class=line><span class=cl><span class=nb>cd</span> audiobook-processor
</span></span></code></pre></div><h2 id=step-by-step-usage-guide>Step-by-Step Usage Guide<a class=td-heading-self-link href=#step-by-step-usage-guide aria-label="Heading self-link"></a></h2><ol><li><strong>Prepare the files</strong></li></ol><ul><li>Copy your M4B file in the <em>audiobook-processor</em> directory.</li><li>Save the script as <code>audiobook-processor.py</code> in the same directory.</li></ul><ol start=2><li><strong>Basic Usage Example</strong><br>Open a command prompt and navigate to the <em>audiobook-processor</em> directory.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Process with default settings</span>
</span></span><span class=line><span class=cl>python audiobook-processor.py audiobook.m4b output_folder
</span></span></code></pre></div><ol start=3><li><strong>Advanced Usage Examples</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Process with higher speed (1.05%) and shorter chunks (5 minutes):</span>
</span></span><span class=line><span class=cl>python audiobook-processor.py audiobook.m4b output_folder --chunk-duration <span class=m>5</span> --speed 1.05
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Process with custom audio quality (256kb):</span>
</span></span><span class=line><span class=cl>python audiobook-processor.py audiobook.m4b output_folder --quality <span class=m>256</span> --sample-rate <span class=m>48000</span>
</span></span></code></pre></div><h3 id=common-issues-and-solutions>Common Issues and Solutions<a class=td-heading-self-link href=#common-issues-and-solutions aria-label="Heading self-link"></a></h3><div class="alert alert-warning" role=alert><h4 class=alert-heading>Troubleshooting</h4><p><strong>&ldquo;FFmpeg not found&rdquo; error</strong></p><ul><li>Verify FFmpeg installation with <code>ffmpeg -version</code></li><li>Make sure FFmpeg is in your system PATH</li><li>Try restarting your terminal</li></ul><p><strong>&ldquo;Permission denied&rdquo; error</strong></p><ul><li>Run terminal as administrator (Windows)</li><li>Check folder permissions</li><li>Verify write access to output directory</li></ul><p><strong>Script fails to read M4B file</strong></p><ul><li>Verify file path has no special characters</li><li>Try using absolute paths</li></ul></div><h2 id=conclusion>Conclusion<a class=td-heading-self-link href=#conclusion aria-label="Heading self-link"></a></h2><p>This script solves a specific but common problem: making audiobooks more accessible for systems with limited playback capabilities. By leveraging FFmpeg&rsquo;s powerful features through a Python wrapper, we&rsquo;ve created a flexible tool that can handle various audio processing needs while maintaining quality and usability.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2024/11/09/welcome-to-my-ui-programming-journey-in-unreal-engine/ aria-label="Previous - Welcome to My UI Programming Journey in Unreal Engine" class="btn btn-primary"><span class=me-1></span>Previous</a></li><li><a href=/blog/2024/11/16/unreal-engine-5.5-next-gen-rendering-and-performance/ aria-label="Next - Unreal Engine 5.5: Next-Gen Rendering and Performance" class="btn btn-primary">Next<span class=ms-1></span></a></li></ul></div></main></div></div></div><script src=/js/main.min.7068b289ffa87ad38c9e860472e55992789ec2c7307e963acf1b3a7a7bf12591.js integrity="sha256-cGiyif+oetOMnoYEcuVZkniewscwfpY6zxs6envxJZE=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>